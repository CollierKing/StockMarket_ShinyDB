g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",curr_rsi_q), x = .8*max(event_summ_tbl$return),
y = nrow(event_summ_tbl*.9), size = 4, colour = "black")
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",curr_rsi_q), x = .8*max(event_summ_tbl$return),
y = nrow(event_summ_tbl*.9), size = 4, colour = "black")
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",curr_rsi_q), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl*.9), size = 4, colour = "black")
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",curr_rsi_q), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",rsi_q_current), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
g1
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",rsi_q_current), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl)-1, size = 4, colour = "black")
g1
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",rsi_q_current), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.8, size = 4, colour = "black")
g1
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",rsi_q_current), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",rsi_q_current), y = .8*max(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Day:",curr_rsi_q), y = .8*max(event_summ_tbl$max_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Day:",curr_rsi_q), y = .8*min(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Day:",rsi_q_current), y = .8*min(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("Max_Day:",rsi_q_current), y = .8*min(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g2
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*max(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("Min_Day:",rsi_q_current), y = .8*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g2
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .8*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("Min_Day:",rsi_q_current), y = .8*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g2
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("Min_Day:",rsi_q_current), y = .9*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g2
g1 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = return,fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Return: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
g2 <- ggplot(data = event_summ_tbl, aes(x = event_summ_tbl[,1], y = min_day, fill=rsi_q)) +
geom_bar(stat = "identity",alpha = 0.7) + ggtitle(paste0("Min_Day: ",event)) +
coord_flip() +  scale_x_discrete(limits = rev(levels(event_summ_tbl[,1]))) +
scale_fill_manual(values = c("[0,0.2)" = "tomato1", "[0.2,0.4)" = "orange", "[0.4,0.6)" = "gold2", "[0.6,0.8)" = "lightgreen", "[0.8,1]" = "springgreen4","NULL"="black")) + xlab("") +ylab("") + theme(legend.position="none")
#
# #plot current rsi details
g1 <- g1 + annotate("text", label = paste0("RSI_q:",rsi_q_current), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g1 <- g1 + annotate("text", label = paste0("Max_Return: ",return_mean_current_rsi), y = .9*min(event_summ_tbl$return),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("RSI_q: ",rsi_q_current), y = .9*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl), size = 4, colour = "black")
#
g2 <- g2 + annotate("text", label = paste0("Min_Day:",day_mean_current_rsi), y = .9*max(event_summ_tbl$min_day),
x = nrow(event_summ_tbl)*.95, size = 4, colour = "black")
g1
g2
# library(readr)
library(DT)
library(dplyr)
library(tidyr)
# library(googledrive)
library(crosstalk)
library(htmltools)
library(htmlTable)
# library(tidyverse)
library(tidyquant)
library(scales)
library(bdscale)
library(ggplot2)
library(quantmod)
library(rvest)
library(XML)
library(gridExtra)
library(grid)
library(cowplot)
library(RCurl)
library(htmlwidgets)
library(flexdashboard)
g_file_txt <- getURL("https://raw.githubusercontent.com/CollierKing/StockMarket_ShinyDB/master/all_trades.csv")
g_file <- read.csv(text=g_file_txt,stringsAsFactors = FALSE)
g_file$TradeDate <- as.Date(g_file$TradeDate)
# options(shiny.error = function() {
#   # stop("Waiting for user to load data..")
#     stop("")
# })
## Define Functions - Ticker Query
tickerQuery <- function(ticker,time_frame){
# ticker <- "AAPL"
getSymbols.google(ticker,env = globalenv())
input <- as.data.frame(get(ticker))
colnames(input) <- c("Open",
"High",
"Low",
"Close",
"Volume")
input <- input[!is.na(input$Close),]
input$date <- row.names(input)
if (time_frame=="Weekly"){
#reformat for weekly time frame
mondays = as.POSIXlt(input$date)$wday == 1
tuesdays = as.POSIXlt(input$date)$wday == 2
wednesdays = as.POSIXlt(input$date)$wday == 3
thursdays = as.POSIXlt(input$date)$wday == 4
fridays = as.POSIXlt(input$date)$wday == 5
indx_mondays <- c(0, which(mondays))
indx_tuesdays <- c(0, which(tuesdays))
indx_wednesdays <- c(0, which(wednesdays))
indx_thursdays <- c(0, which(thursdays))
indx_fridays <- c(0, which(fridays))
open <- as.data.frame(input[,1])
colnames(open) <- "open"
open$index = 1:nrow(open)
input$mondays <- indx_mondays[match(open$index,indx_mondays)]
input$tuesdays <- indx_tuesdays[match(open$index,indx_tuesdays)]
input$wednesdays <- indx_wednesdays[match(open$index,indx_wednesdays)]
input$thursdays <- indx_thursdays[match(open$index,indx_thursdays)]
input$fridays <- indx_fridays[match(open$index,indx_fridays)]
input$weekday <- ifelse(!is.na(input$mondays),1,
ifelse(!is.na(input$tuesdays),2,
ifelse(!is.na(input$wednesdays),3,
ifelse(!is.na(input$thursdays),4,
ifelse(!is.na(input$fridays),5,NA)))))
input$week_num <- NA
week = 0
try(for (i in 1:nrow(input)){
if(input$weekday[i]>input$weekday[i+1]){
week = week + 1
input$week_num[i+1] <- week
}  else {
input$week_num[i+1] <- week
}
},silent=FALSE)
#patch up
input$week_num[1] <- input$week_num[2]
input %>% group_by(week_num) %>%
summarise(
size = n(),
date = first(date),
Open = first(Open),
Low = min(Low),
High = max(High),
Close = last(Close),
# adjusted = last(adjusted),
Volume = sum(Volume)
) -> input
}
#add technical indicators
try(input$ma50 <- SMA(input$Close,50),silent=TRUE)
try(input$ma21 <- SMA(input$Close,21),silent=TRUE)
try(input$ma9 <- SMA(input$Close,9),silent=TRUE)
try(bbands <- as.data.frame(BBands(input$Close, n=20,sd=2)),silent=TRUE)
try(bbands <- bbands[,c("up","dn")],silent = TRUE)
try(input <- cbind(input,bbands),silent = TRUE)
input$pos_neg <- ifelse(input$Close>lag(input$Close,1),"red","green")
try(input$RSI <- RSI(input$Close))
try(macd <- as.data.frame(MACD(input$Close)))
try(input <- cbind(input,macd),silent = TRUE)
try(input$macd_delt <- input$macd-input$signal)
input$date <- as.Date(input$date)
return(input)
}
input <- tickerQuery("SNAP","Daily")
input2 <- input
View(input2)
input2$price_cross_9_up <- ifelse(input2$Close>input2$ma9 &
lag(input2$Close,n=1) < lag(input2$ma9,n=1) &
lag(input2$ma9)>0,1,NA)
input2$price_cross_9_up <- ifelse(input2$Close>input2$ma9 &
lag(input2$Close,n=1) < lag(input2$ma9,n=1),1,NA)
input2 <- input
input2$price_cross_9_up <- ifelse(input2$Close>input2$ma9 &
lag(input2$Close,n=1) < lag(input2$ma9,n=1),1,NA)
input2$price_cross_9_dn <- ifelse(input2$Close<input2$ma9 &
lag(input2$Close,n=1) > lag(input2$ma9,n=1),1,NA)
## Above 9 sma Cross
input2$price_cross_9_up <- ifelse(input2$Close>input2$ma9 &
lag(input2$Close,n=1) < lag(input2$ma9,n=1),1,NA)
## Below 9 sma Cross
input2$price_cross_9_dn <- ifelse(input2$Close<input2$ma9 &
lag(input2$Close,n=1) > lag(input2$ma9,n=1),1,NA)
# price vs 9 ma
View(input2)
input2 <- input
### MA CROSS FLAGS
######################
#Price vs MAs
## Above 9 sma Cross
input2$price_cross_9_up <- ifelse(input2$Close>input2$ma9 &
lag(input2$Close,n=1) < lag(input2$ma9,n=1),1,NA)
## Below 9 sma Cross
input2$price_cross_9_dn <- ifelse(input2$Close<input2$ma9 &
lag(input2$Close,n=1) > lag(input2$ma9,n=1),1,NA)
# price vs 9 ma
input2$price_cross_9 <- ifelse(input2$Close<input2$ma9,"under","over")
## Above 21 sma Cross
input2$price_cross_21_up <- ifelse(input2$Close>input2$ma21 &
lag(input2$Close,n=1) < lag(input2$ma21,n=1),1,NA)
## Below 21 sma Cross
input2$price_cross_21_dn <- ifelse(input2$Close<input2$ma21 &
lag(input2$Close,n=1) > lag(input2$ma21,n=1),1,NA)
# price vs 21 ma
input2$price_cross_21 <- ifelse(input2$Close<input2$ma21,"under","over")
## Above 50 sma Cross
input2$price_cross_50_up <- ifelse(input2$Close>input2$ma50 &
lag(input2$Close,n=1) < lag(input2$ma50,n=1),1,NA)
## Below 50 sma Cross
input2$price_cross_50_dn <- ifelse(input2$Close<input2$ma50 &
lag(input2$Close,n=1) > lag(input2$ma50,n=1),1,NA)
# price vs 50 ma
input2$price_cross_50 <- ifelse(input2$Close<input2$ma50,"under","over")
# 9 vs MAs
## Above 21 sma Cross
input2$ma9_cross_21_up <- ifelse(input2$ma9>input2$ma21 & lag(input2$ma9,n=1) < lag(input2$ma21,n=1),1,NA)
## Below 21 sma Cross
input2$ma9_cross_21_dn <- ifelse(input2$ma9<input2$ma21 & lag(input2$ma9,n=1) > lag(input2$ma21,n=1),1,NA)
# 9 vs 21 ma
input2$ma9_cross_21 <- ifelse(input2$ma9<input2$ma21,"under","over")
## Above 50 sma Cross
input2$ma9_cross_50_up <- ifelse(input2$ma9>input2$ma50 & lag(input2$ma9,n=1) < lag(input2$ma50,n=1),1,NA)
## Below 50 sma Cross
input2$ma9_cross_50_dn <- ifelse(input2$ma9<input2$ma50 & lag(input2$ma9,n=1) > lag(input2$ma50,n=1),1,NA)
# 9 vs 50 ma
input2$ma9_cross_50 <- ifelse(input2$ma9<input2$ma50,"under","over")
# 21 vs MAs
## Above 9 sma Cross
input2$ma21_cross_9_up <- ifelse(input2$ma21>input2$ma9 & lag(input2$ma21,n=1) < lag(input2$ma9,n=1),1,NA)
## Below 9 sma Cross
input2$ma21_cross_9_dn <- ifelse(input2$ma21<input2$ma9 & lag(input2$ma21,n=1) > lag(input2$ma9,n=1),1,NA)
# 21 vs 9 ma
input2$ma21_cross_9 <- ifelse(input2$ma21<input2$ma9,"under","over")
## Above 50 sma Cross
input2$ma21_cross_50_up <- ifelse(input2$ma21>input2$ma50 & lag(input2$ma21,n=1) < lag(input2$ma50,n=1),1,NA)
## Below 50 sma Cross
input2$ma21_cross_50_dn <- ifelse(input2$ma21<input2$ma50 & lag(input2$ma21,n=1) > lag(input2$ma50,n=1),1,NA)
# 21 vs 50 ma
input2$ma21_cross_50 <- ifelse(input2$ma21<input2$ma50,"under","over")
# 50 vs MAs
## Above 9 sma Cross
input2$ma50_cross_9_up <- ifelse(input2$ma50>input2$ma9 & lag(input2$ma50,n=1) < lag(input2$ma9,n=1),1,NA)
## Below 9 sma Cross
input2$ma50_cross_9_dn <- ifelse(input2$ma50<input2$ma9 & lag(input2$ma50,n=1) > lag(input2$ma9,n=1),1,NA)
# 50 vs 9 ma
input2$ma50_cross_9 <- ifelse(input2$ma50<input2$ma9,"under","over")
## Above 21 sma Cross
input2$ma50_cross_21_up <- ifelse(input2$ma50>input2$ma21 & lag(input2$ma50,n=1) < lag(input2$ma21,n=1),1,NA)
## Below 21 sma Cross
input2$ma50_cross_21_dn <- ifelse(input2$ma50<input2$ma21 & lag(input2$ma50,n=1) > lag(input2$ma21,n=1),1,NA)
# 50 vs 21 ma
input2$ma50_cross_21 <- ifelse(input2$ma50<input2$ma21,"under","over")
#MACD cross
input2$macd_cross_up <- ifelse(input2$macd>input2$signal & lag(input2$macd,n=1) < lag(input2$signal,n=1),1,NA)
input2$macd_cross_dn <- ifelse(input2$macd<input2$signal & lag(input2$macd,n=1) > lag(input2$signal,n=1),1,NA)
input2$macd_cross <- ifelse(input2$macd<input2$signal,"under","over")
#RSI Quantile
perc.rank <- function(x) trunc(rank(x,na.last = NA))/sum(!is.na(x))
xr <- perc.rank((input2$RSI))
xr_add <- rep(NA,nrow(input2)-length(xr))
xr <- c(xr_add,xr)
input2$RSI_q <- xr
q_cuts <- seq(0,1,.2)
input2$RSI_q_bins <- cut(input2$RSI_q,q_cuts,right=FALSE,include.lowest = TRUE)
### MA CROSS SERIES
######################
events = c("price_cross_9_up","price_cross_9_dn","price_cross_21_up","price_cross_21_dn","price_cross_50_up",
"price_cross_50_dn","ma9_cross_21_up","ma9_cross_21_dn","ma9_cross_50_up","ma9_cross_50_dn",
"ma21_cross_9_up","ma21_cross_9_dn","ma21_cross_50_up","ma21_cross_50_dn","ma50_cross_9_up",
"ma50_cross_9_dn","ma50_cross_21_up","ma50_cross_21_dn","macd_cross_up","macd_cross_dn")
# Drag down event counters per occurance
for(j in 1:length(events)){
event = events[j]
counter = 0
for (i in 1:nrow(input2)){
if(!is.na(input2[,event][i])){
counter = counter + 1
}
input2[,event][i] = counter
}
}
input2
event = "price_cross_9_dn"
comp = substr(event,1,nchar(event)-3)
comp_tbl = input2 %>% filter_(paste(comp, "== 'under'"))
comp_tbl %>% group_by_(event) %>%
summarise(min_price = min(Close),
start_price = first(Close),
return = round((min_price-start_price)/start_price,4),
min_day = sum(which(Close == min_price)),
tot_days = n()) %>%
filter (return !=0) %>% # filter out erroneous crosses (where opposite cross happened)
summarise(total_occurances = n(),
avg_min_return = mean(return,na.rm=TRUE),
avg_min_day = mean(min_day),
avg_tot_days = mean(tot_days)) -> summ_tbl
View(summ_tbl)
View(comp_tbl)
View(summ_tbl)
